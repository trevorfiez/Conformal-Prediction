# Conformal Prediction for CIFAR-10 Using a Log Loss for the Final Layer #

I trained the network for 100,000 batches using SGD with just the default parameters from the example.

## Model precision and recall for a model trained with class weights ##

For the entire network where I would check to see that the label was correctly labeled 1 but could also output multiple
postive labels:

Recall = 0.946

Precision = 0.578

Just using the top-k highest scoring labels though the precision and recall are as follows:

| Top k | Recall | Precision |
| :---: | :---: | :---: |
| 1 | 0.812 | 0.812 |
| 2 | 0.927 | 0.463 |
| 3 | 0.966 | 0.322 |
| 4 | 0.982 | 0.246 |
| 5 | 0.991 | 0.198 |
| 6 | 0.995 | 0.166 |
| 7 | 0.997 | 0.143 |
| 8 | 0.999 | 0.125 |
| 9 | 0.999 | 0.111 |

## Model trained without sample weights ##

The recall and precision from the output of the network is:

Recall = 0.796

Precision = 0.895.

The top-k precision and recall is as follows:


| Top k | Recall | Precision |
| :---: | :---: | :---: |
| 1 | 0.848 | 0.86 |
| 2 | 0.941 | 0.473 |
| 3 | 0.970 | 0.325 |
| 4 | 0.985 | 0.247 |
| 5 | 0.993 | 0.199 |
| 6 | 0.996 | 0.166 |
| 7 | 0.998 | 0.143 |
| 8 | 0.999 | 0.125 |
| 9 | 1.000 | 0.111 |


## Tables for Different Weights ##

Each table element is formatted as recall / precision / average set size.

The title for each table denotes the weight on negative samples.

### Weight 1.0 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| Top-k | 0.851 / 0.851 / 1.00 | 0.938 / 0.469 / 2.00 | 0.972 / 0.324 / 3.00 | 0.985 / 0.246 / 4.00 | 0.992 / 0.198 / 5.00 | 0.996 / 0.166 / 6.00 |
| All-threshold | 0.848 / 0.858 / 0.99 | 0.933 / 0.680 / 1.37 | 0.972 / 0.520 / 1.87 | 0.986 / 0.420 / 2.35 | 0.993 / 0.348 / 2.85 | 0.996 / 0.290 / 3.43 |
| Class Threshold | 0.848 / 0.858 / 0.99 | 0.933 / 0.680 / 1.37 | 0.972 / 0.520 / 1.87 | 0.986 / 0.420 / 2.35 | 0.993 / 0.348 / 2.85 | 0.996 / 0.290 / 3.43 |
| Diff Pre-sigmoid | 0.849 / 0.861 / 0.99 | 0.934 / 0.679 / 1.38 | 0.972 / 0.493 / 1.97 | 0.983 / 0.392 / 2.51 | 0.991 / 0.322 / 3.08 | 0.996 / 0.244 / 4.08 |
| Diff | 0.847 / 0.856 / 0.99 | 0.934 / 0.537 / 1.74 | 0.970 / 0.326 / 2.97 | 0.982 / 0.264 / 3.72 | 0.990 / 0.224 / 4.43 | 0.995 / 0.190 / 5.23 |
| Ratio | 0.846 / 0.855 / 0.99 | 0.933 / 0.680 / 1.37 | 0.970 / 0.519 / 1.87 | 0.986 / 0.417 / 2.37 | 0.992 / 0.354 / 2.80 | 0.997 / 0.284 / 3.51 |

### Weight 0.75 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| Top-k | 0.844 / 0.844 / 1.00 | 0.939 / 0.470 / 2.00 | 0.970 / 0.323 / 3.00 | 0.986 / 0.246 / 4.00 | 0.993 / 0.199 / 5.00 | 0.996 / 0.166 / 6.00 |
| All-threshold | 0.842 / 0.850 / 0.99 | 0.941 / 0.666 / 1.41 | 0.972 / 0.513 / 1.89 | 0.988 / 0.401 / 2.46 | 0.994 / 0.338 / 2.94 | 0.997 / 0.283 / 3.52 |
| Class Threshold | 0.842 / 0.850 / 0.99 | 0.941 / 0.666 / 1.41 | 0.972 / 0.513 / 1.89 | 0.988 / 0.401 / 2.46 | 0.994 / 0.338 / 2.94 | 0.997 / 0.283 / 3.52 |
| Diff Pre-sigmoid | 0.841 / 0.851 / 0.99 | 0.939 / 0.654 / 1.44 | 0.973 / 0.484 / 2.01 | 0.986 / 0.362 / 2.72 | 0.993 / 0.297 / 3.34 | 0.996 / 0.253 / 3.93 |
| Diff | 0.840 / 0.851 / 0.99 | 0.936 / 0.552 / 1.70 | 0.970 / 0.342 / 2.83 | 0.985 / 0.260 / 3.78 | 0.993 / 0.219 / 4.53 | 0.996 / 0.196 / 5.09 |
| Ratio | 0.839 / 0.851 / 0.99 | 0.938 / 0.667 / 1.41 | 0.973 / 0.514 / 1.89 | 0.988 / 0.402 / 2.46 | 0.993 / 0.337 / 2.95 | 0.997 / 0.281 / 3.55 |

### Weight 0.5 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| Top-k | 0.841 / 0.841 / 1.00 | 0.936 / 0.468 / 2.00 | 0.970 / 0.323 / 3.00 | 0.985 / 0.246 / 4.00 | 0.991 / 0.198 / 5.00 | 0.995 / 0.166 / 6.00 |
| All-threshold | 0.835 / 0.851 / 0.98 | 0.932 / 0.672 / 1.39 | 0.967 / 0.534 / 1.81 | 0.986 / 0.416 / 2.37 | 0.991 / 0.359 / 2.76 | 0.995 / 0.299 / 3.33 |
| Class Threshold | 0.835 / 0.851 / 0.98 | 0.932 / 0.672 / 1.39 | 0.967 / 0.534 / 1.81 | 0.986 / 0.416 / 2.37 | 0.991 / 0.359 / 2.76 | 0.995 / 0.299 / 3.33 |
| Diff Pre-sigmoid | 0.837 / 0.848 / 0.99 | 0.932 / 0.655 / 1.42 | 0.968 / 0.499 / 1.94 | 0.983 / 0.383 / 2.57 | 0.991 / 0.311 / 3.18 | 0.995 / 0.267 / 3.72 |
| Diff | 0.838 / 0.844 / 0.99 | 0.000 / 0.000 / 0.00 | 0.968 / 0.398 / 2.43 | 0.983 / 0.282 / 3.49 | 0.989 / 0.244 / 4.06 | 0.994 / 0.215 / 4.63 |
| Ratio | 0.838 / 0.844 / 0.99 | 0.931 / 0.671 / 1.39 | 0.966 / 0.536 / 1.80 | 0.985 / 0.421 / 2.34 | 0.991 / 0.356 / 2.79 | 0.995 / 0.300 / 3.32 |

### Weight 0.05 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| Top-k | 0.779 / 0.779 / 1.00 | 0.911 / 0.455 / 2.00 | 0.956 / 0.319 / 3.00 | 0.976 / 0.244 / 4.00 | 0.989 / 0.198 / 5.00 | 0.994 / 0.166 / 6.00 |
| All-threshold | 0.780 / 0.786 / 0.99 | 0.907 / 0.585 / 1.55 | 0.960 / 0.445 / 2.16 | 0.977 / 0.366 / 2.67 | 0.990 / 0.288 / 3.44 | 0.994 / 0.247 / 4.02 |
| Class Threshold | 0.780 / 0.786 / 0.99 | 0.907 / 0.585 / 1.55 | 0.960 / 0.445 / 2.16 | 0.977 / 0.366 / 2.67 | 0.990 / 0.288 / 3.44 | 0.994 / 0.247 / 4.02 |
| Diff Pre-sigmoid | 0.770 / 0.787 / 0.98 | 0.905 / 0.573 / 1.58 | 0.957 / 0.430 / 2.22 | 0.978 / 0.343 / 2.85 | 0.991 / 0.262 / 3.78 | 0.994 / 0.232 / 4.28 |
| Diff | 0.772 / 0.784 / 0.98 | 0.904 / 0.595 / 1.52 | 0.960 / 0.447 / 2.15 | 0.977 / 0.370 / 2.64 | 0.991 / 0.291 / 3.41 | 0.995 / 0.243 / 4.09 |
| Ratio | 0.772 / 0.785 / 0.98 | 0.905 / 0.595 / 1.52 | 0.960 / 0.448 / 2.14 | 0.978 / 0.366 / 2.67 | 0.991 / 0.287 / 3.45 | 0.995 / 0.246 / 4.05 |

### Weight 0.25 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| Top-k | 0.831 / 0.831 / 1.00 | 0.933 / 0.466 / 2.00 | 0.969 / 0.323 / 3.00 | 0.985 / 0.246 / 4.00 | 0.993 / 0.199 / 5.00 | 0.996 / 0.166 / 6.00 |
| All-threshold | 0.826 / 0.841 / 0.98 | 0.931 / 0.647 / 1.44 | 0.971 / 0.494 / 1.97 | 0.988 / 0.383 / 2.58 | 0.994 / 0.318 / 3.13 | 0.996 / 0.274 / 3.64 |
| Class Threshold | 0.826 / 0.841 / 0.98 | 0.931 / 0.647 / 1.44 | 0.971 / 0.494 / 1.97 | 0.988 / 0.383 / 2.58 | 0.994 / 0.318 / 3.13 | 0.996 / 0.274 / 3.64 |
| Diff Pre-sigmoid | 0.823 / 0.842 / 0.98 | 0.935 / 0.620 / 1.51 | 0.971 / 0.461 / 2.11 | 0.985 / 0.348 / 2.83 | 0.994 / 0.276 / 3.59 | 0.996 / 0.234 / 4.26 |
| Diff | 0.823 / 0.840 / 0.98 | 0.934 / 0.626 / 1.49 | 0.971 / 0.441 / 2.20 | 0.987 / 0.312 / 3.17 | 0.993 / 0.251 / 3.95 | 0.996 / 0.212 / 4.70 |
| Ratio | 0.822 / 0.841 / 0.98 | 0.931 / 0.647 / 1.44 | 0.971 / 0.497 / 1.96 | 0.987 / 0.389 / 2.54 | 0.993 / 0.321 / 3.10 | 0.996 / 0.274 / 3.64 |

### Weight 0.01 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| Top-k | 0.572 / 0.572 / 1.00 | 0.785 / 0.392 / 2.00 | 0.880 / 0.293 / 3.00 | 0.930 / 0.233 / 4.00 | 0.963 / 0.193 / 5.00 | 0.981 / 0.164 / 6.00 |
| All-threshold | 0.568 / 0.557 / 1.02 | 0.779 / 0.415 / 1.88 | 0.873 / 0.338 / 2.58 | 0.927 / 0.285 / 3.25 | 0.963 / 0.236 / 4.07 | 0.983 / 0.203 / 4.83 |
| Class Threshold | 0.568 / 0.557 / 1.02 | 0.779 / 0.415 / 1.88 | 0.873 / 0.338 / 2.58 | 0.927 / 0.285 / 3.25 | 0.963 / 0.236 / 4.07 | 0.983 / 0.203 / 4.83 |
| Diff Pre-sigmoid | 0.571 / 0.573 / 1.00 | 0.777 / 0.423 / 1.84 | 0.877 / 0.332 / 2.64 | 0.927 / 0.277 / 3.34 | 0.962 / 0.234 / 4.11 | 0.980 / 0.203 / 4.82 |
| Diff | 0.572 / 0.573 / 1.00 | 0.781 / 0.425 / 1.84 | 0.873 / 0.342 / 2.55 | 0.929 / 0.287 / 3.24 | 0.964 / 0.239 / 4.04 | 0.983 / 0.204 / 4.82 |
| Ratio | 0.572 / 0.573 / 1.00 | 0.782 / 0.424 / 1.84 | 0.873 / 0.342 / 2.56 | 0.929 / 0.287 / 3.24 | 0.964 / 0.238 / 4.05 | 0.982 / 0.204 / 4.82 |

## Number of Predicted Labels for Different Thresholds ##

Each table element is formated as:  % of predictions with 1 label / % of labels with 2-3 labels / % of labels with 4+ labels

The title for each table denotes the weight on negative samples.

### Weight 1.00 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| All-threshold | 0.911 / 0.089 / 0.00 | 0.692 / 0.304 / 0.00 | 0.527 / 0.360 / 0.11 | 0.437 / 0.337 / 0.23 | 0.367 / 0.312 / 0.32 | 0.307 / 0.275 / 0.42 |
| Class Threshold | 0.852 / 0.148 / 0.00 | 0.684 / 0.305 / 0.01 | 0.518 / 0.354 / 0.13 | 0.428 / 0.333 / 0.24 | 0.345 / 0.314 / 0.34 | 0.259 / 0.297 / 0.44 |
| Diff Pre-sigmoid | 0.929 / 0.071 / 0.00 | 0.760 / 0.210 / 0.03 | 0.645 / 0.187 / 0.17 | 0.577 / 0.178 / 0.24 | 0.516 / 0.167 / 0.32 | 0.426 / 0.143 / 0.43 |
| Diff | 0.989 / 0.011 / 0.00 | 0.808 / 0.113 / 0.08 | 0.696 / 0.087 / 0.22 | 0.626 / 0.072 / 0.30 | 0.549 / 0.072 / 0.38 | 0.467 / 0.062 / 0.47 |
| Ratio | 0.990 / 0.010 / 0.00 | 0.751 / 0.219 / 0.03 | 0.588 / 0.289 / 0.12 | 0.484 / 0.299 / 0.22 | 0.415 / 0.294 / 0.29 | 0.330 / 0.267 / 0.40 |

### Weight 0.75 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| All-threshold | 0.907 / 0.093 / 0.00 | 0.669 / 0.322 / 0.01 | 0.518 / 0.365 / 0.12 | 0.418 / 0.330 / 0.25 | 0.349 / 0.310 / 0.34 | 0.287 / 0.278 / 0.43 |
| Class Threshold | 0.850 / 0.150 / 0.00 | 0.661 / 0.321 / 0.02 | 0.510 / 0.359 / 0.13 | 0.408 / 0.330 / 0.26 | 0.347 / 0.313 / 0.34 | 0.272 / 0.269 / 0.46 |
| Diff Pre-sigmoid | 0.938 / 0.062 / 0.00 | 0.750 / 0.199 / 0.05 | 0.641 / 0.190 / 0.17 | 0.549 / 0.179 / 0.27 | 0.489 / 0.157 / 0.35 | 0.433 / 0.148 / 0.42 |
| Diff | 0.988 / 0.012 / 0.00 | 0.790 / 0.134 / 0.08 | 0.682 / 0.116 / 0.20 | 0.589 / 0.102 / 0.31 | 0.512 / 0.094 / 0.39 | 0.455 / 0.089 / 0.46 |
| Ratio | 0.986 / 0.014 / 0.00 | 0.731 / 0.237 / 0.03 | 0.569 / 0.306 / 0.13 | 0.456 / 0.307 / 0.24 | 0.382 / 0.295 / 0.32 | 0.310 / 0.271 / 0.42 |

### Weight 0.5 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| All-threshold | 0.903 / 0.097 / 0.00 | 0.677 / 0.318 / 0.01 | 0.524 / 0.391 / 0.09 | 0.414 / 0.361 / 0.22 | 0.359 / 0.334 / 0.31 | 0.290 / 0.300 / 0.41 |
| Class Threshold | 0.847 / 0.153 / 0.00 | 0.666 / 0.322 / 0.01 | 0.517 / 0.385 / 0.10 | 0.402 / 0.360 / 0.24 | 0.333 / 0.342 / 0.32 | 0.266 / 0.310 / 0.42 |
| Diff Pre-sigmoid | 0.964 / 0.036 / 0.00 | 0.759 / 0.189 / 0.05 | 0.646 / 0.205 / 0.15 | 0.557 / 0.191 / 0.25 | 0.493 / 0.170 / 0.34 | 0.440 / 0.159 / 0.40 |
| Diff | 0.992 / 0.008 / 0.00 | 0.770 / 0.169 / 0.06 | 0.665 / 0.176 / 0.16 | 0.564 / 0.158 / 0.28 | 0.507 / 0.151 / 0.34 | 0.448 / 0.143 / 0.41 |
| Ratio | 0.993 / 0.007 / 0.00 | 0.723 / 0.254 / 0.02 | 0.571 / 0.332 / 0.10 | 0.448 / 0.342 / 0.21 | 0.381 / 0.319 / 0.30 | 0.313 / 0.295 / 0.39 |

### Weight 0.25 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| All-threshold | 0.891 / 0.109 / 0.00 | 0.641 / 0.352 / 0.01 | 0.465 / 0.416 / 0.12 | 0.353 / 0.377 / 0.27 | 0.278 / 0.339 / 0.38 | 0.225 / 0.306 / 0.47 |
| Class Threshold | 0.836 / 0.164 / 0.00 | 0.619 / 0.363 / 0.02 | 0.465 / 0.396 / 0.14 | 0.350 / 0.376 / 0.27 | 0.271 / 0.339 / 0.39 | 0.222 / 0.322 / 0.46 |
| Diff Pre-sigmoid | 0.977 / 0.023 / 0.00 | 0.733 / 0.202 / 0.06 | 0.597 / 0.224 / 0.18 | 0.504 / 0.202 / 0.29 | 0.426 / 0.175 / 0.40 | 0.371 / 0.154 / 0.47 |
| Diff | 0.979 / 0.021 / 0.00 | 0.712 / 0.240 / 0.05 | 0.567 / 0.286 / 0.15 | 0.467 / 0.274 / 0.26 | 0.397 / 0.248 / 0.36 | 0.330 / 0.227 / 0.44 |
| Ratio | 0.978 / 0.022 / 0.00 | 0.679 / 0.298 / 0.02 | 0.494 / 0.384 / 0.12 | 0.380 / 0.368 / 0.25 | 0.299 / 0.333 / 0.37 | 0.235 / 0.307 / 0.46 |

### Weight 0.05 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| All-threshold | 0.838 / 0.162 / 0.00 | 0.545 / 0.448 / 0.01 | 0.346 / 0.519 / 0.14 | 0.253 / 0.479 / 0.27 | 0.156 / 0.407 / 0.44 | 0.104 / 0.351 / 0.54 |
| Class Threshold | 0.775 / 0.225 / 0.00 | 0.525 / 0.452 / 0.02 | 0.353 / 0.489 / 0.16 | 0.250 / 0.460 / 0.29 | 0.151 / 0.404 / 0.45 | 0.091 / 0.341 / 0.57 |
| Diff Pre-sigmoid | 0.978 / 0.022 / 0.00 | 0.671 / 0.262 / 0.07 | 0.515 / 0.291 / 0.19 | 0.423 / 0.268 / 0.31 | 0.322 / 0.231 / 0.45 | 0.281 / 0.208 / 0.51 |
| Diff | 0.984 / 0.016 / 0.00 | 0.601 / 0.379 / 0.02 | 0.377 / 0.479 / 0.14 | 0.283 / 0.459 / 0.26 | 0.180 / 0.405 / 0.41 | 0.122 / 0.349 / 0.53 |
| Ratio | 0.983 / 0.017 / 0.00 | 0.593 / 0.390 / 0.02 | 0.367 / 0.496 / 0.14 | 0.263 / 0.470 / 0.27 | 0.160 / 0.406 / 0.43 | 0.105 / 0.348 / 0.55 |

### Weight 0.01 ###

| k | 1 | 2 | 3 | 4 | 5 | 6 |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: 
| All-threshold | 0.511 / 0.489 / 0.00 | 0.244 / 0.747 / 0.01 | 0.066 / 0.795 / 0.14 | 0.027 / 0.605 / 0.37 | 0.011 / 0.372 / 0.62 | 0.003 / 0.222 / 0.77 |
| Class Threshold | 0.482 / 0.518 / 0.00 | 0.269 / 0.709 / 0.02 | 0.086 / 0.747 / 0.17 | 0.026 / 0.586 / 0.39 | 0.009 / 0.372 / 0.62 | 0.003 / 0.216 / 0.78 |
| Diff Pre-sigmoid | 0.997 / 0.003 / 0.00 | 0.454 / 0.477 / 0.07 | 0.236 / 0.529 / 0.23 | 0.134 / 0.483 / 0.38 | 0.071 / 0.382 / 0.55 | 0.039 / 0.292 / 0.67 |
| Diff | 0.998 / 0.002 / 0.00 | 0.336 / 0.641 / 0.02 | 0.095 / 0.752 / 0.15 | 0.034 / 0.610 / 0.36 | 0.014 / 0.391 / 0.60 | 0.004 / 0.233 / 0.76 |
| Ratio | 0.998 / 0.002 / 0.00 | 0.332 / 0.646 / 0.02 | 0.093 / 0.755 / 0.15 | 0.033 / 0.611 / 0.36 | 0.013 / 0.386 / 0.60 | 0.004 / 0.231 / 0.77 |



